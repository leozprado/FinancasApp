@page "/edicao-categorias/{Id}"

<div class="card m-4 shadow">
    <div class="card-body">

        <h4>Edição de categoria</h4>
        <p>Modifique os dados da categoria selecionada.</p>

        @if (!string.IsNullOrEmpty(mensagem))
        {
            <div class="alert alert-primary">
                <strong>@mensagem</strong>
            </div>
        }

        @* Formulário de cadastro *@
        <EditForm Model="form" OnValidSubmit="@AtualizarCategoria">

            @* Ativar as validações do formulário *@
            <DataAnnotationsValidator />

            <div class="mb-3">
                <label>Nome da categoria:</label>
                <InputText @bind-Value="form.Nome" class="form-control" />
                <div class="text-danger">
                    <ValidationMessage For="@(() => form.Nome)" />
                </div>
            </div>

            <div class="mb-3">
                <button class="btn btn-primary btn-sm me-2">
                    Salvar alterações
                </button>
                <NavLink href="/consulta-categorias" class="btn btn-secondary btn-sm">
                    Voltar para a consulta
                </NavLink>
            </div>

        </EditForm>

    </div>
</div>

@using FinancasApp.WEB.Models
@using FinancasApp.WEB.Forms

@inject HttpClient Http

@code {

    //Atributo para capturar o ID enviado na URL
    [Parameter]
    public string? Id { get; set; }

    //Criando uma instância do formulário de categoria
    private CadastroCategoriasForm form = new();

    //Atributo para exibir mensagems na página
    private string mensagem = string.Empty;

    //Evento executado ao abrir a página
    protected override async Task OnInitializedAsync()
    {
        //Consultar os dados da categoria na API através do ID
        var categoria = await Http.GetFromJsonAsync<CategoriaModel>("api/categorias/" + Id);
        //Preencher os campos do formulário
        form.Nome = categoria?.nome;
    }

    //Evento para atualizar os dados da categoria
    protected async Task AtualizarCategoria()
    {
        //Fazendo uma chamada POST para cadastrar categoria na API
        var response = await Http.PutAsJsonAsync("api/categorias/" + Id, form);

        //Verificando se a resposta foi um sucesso
        if (response.IsSuccessStatusCode)
        {
            mensagem = $"Categoria '{form.Nome}' atualizada com sucesso!";
        }
        else
        {
            mensagem = "Erro ao cadastrar a categoria.";
        }
    }
}
