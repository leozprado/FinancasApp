@page "/cadastro-categorias"

<div class="card m-4 shadow">
    <div class="card-body">

        <h4>Cadastro de categorias</h4>
        <p>Inclua categorias para cadastro de movimentações financeiras.</p>

        @if (!string.IsNullOrEmpty(mensagem))
        {
            <div class="alert alert-primary">
                <strong>@mensagem</strong>
            </div>
        }

        @* Formulário de cadastro *@
        <EditForm Model="form" OnValidSubmit="@CadastrarCategoria">

            @* Ativar as validações do formulário *@
            <DataAnnotationsValidator />

            <div class="mb-3">
                <label>Nome da categoria:</label>
                <InputText @bind-Value="form.Nome" class="form-control" />
                <div class="text-danger">
                    <ValidationMessage For="@(() => form.Nome)" />
                </div>
            </div>

            <div class="mb-3">
                <button class="btn btn-success btn-sm me-2">
                    Realizar cadastro
                </button>
                <NavLink href="/consulta-categorias" class="btn btn-secondary btn-sm">
                    Voltar para a consulta
                </NavLink>
            </div>

        </EditForm>

    </div>
</div>

@using FinancasApp.WEB.Forms

@inject HttpClient Http

@code {

    //Criando uma instância do formulário de categoria
    private CadastroCategoriasForm form = new();

    //Atributo para exibir mensagems na página
    private string mensagem = string.Empty;

    //Função para capturar o evento de SUBMIT do formulário
    protected async Task CadastrarCategoria()
    {
        //Fazendo uma chamada POST para cadastrar categoria na API
        var response = await Http.PostAsJsonAsync("api/categorias", form);

        //Verificando se a resposta foi um sucesso
        if (response.IsSuccessStatusCode)
        {
            mensagem = $"Categoria '{form.Nome}' cadastrada com sucesso!";
            form = new(); // Limpando o formulário
        }
        else
        {
            mensagem = "Erro ao cadastrar a categoria.";
        }
    }
}
